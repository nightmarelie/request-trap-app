{{#contentFor 'pageNav'}}
    <li class="breadcrumb-item active" aria-current="page">Home</li>
{{/contentFor}}

{{#contentFor 'pageScripts'}}
    <script>
        $(document).ready(function () {
            const requests = new Set($('.list-group-item a').map(function () {
                return $(this).text();
            }).get());

            const socket = io();

            socket.on('requests', function(request) {
                handleRequest(request);
                showHideAlert();
            });

            function handleRequest(request) {
                const {trapId} = request;
                
                if (!trapId) {
                    return;
                }

                if (requests.has(trapId)) {
                    updateRequest(trapId);
                } else {
                    $("ul.list-group").prepend(createRequestItem(trapId).hide().show('fast'));
                }
            }

            function createRequestItem(request, count = 1) {
                return $("<li />")
                    .addClass("list-group-item d-flex justify-content-between align-items-center")
                    .append([$("<a />", {
                        id: request,
                        href: `/${request}/requests`,
                        text: request
                    }), $("<span class=\"badge badge-dark\"></span>").text(count)])
            }

            function updateRequest(request) {
                $(`#${request}`).parent('.list-group-item').find('.badge').text((i, oldval) => ++oldval);
            }
        });
    </script>
{{/contentFor}}

{{#contentFor 'body'}}
    <div class="my-3 p-3 bg-white rounded shadow-sm">
        <h2>Instruction:</h2>
        <ul class="list-group">
            {{#each trapRequests}}
            <li class="list-group-item d-flex justify-content-between align-items-center">
                {{{link _id href="/requests"}}}
                <span class="badge badge-dark">{{count}}</span>
            </li>
            {{/each}}
        </ul>
    </div>
{{/contentFor}}
